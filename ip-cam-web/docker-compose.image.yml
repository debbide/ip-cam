# IP Cam Streamer - Web Edition
# 使用预构建镜像部署
#
# 使用方法:
#   docker-compose up -d
#
# 访问:
#   https://你的服务器IP
#
# WebRTC 说明:
#   如果 WebRTC 视频无法播放，需要设置 WEBRTC_EXTERNAL_IP 为服务器的外部 IP

services:
  ip-cam-web:
    image: ghcr.io/debbide/ip-cam-web:latest
    container_name: ip-cam-web
    restart: unless-stopped
    ports:
      - "80:80"         # HTTP (自动跳转 HTTPS)
      - "443:443"       # HTTPS (主入口)
      - "8554:8554"     # RTSP
      - "8289:8289/udp" # WebRTC ICE
    environment:
      - TZ=Asia/Shanghai
      # 如果 WebRTC 视频无法播放，取消注释并设置服务器外部 IP
      # - WEBRTC_EXTERNAL_IP=192.168.1.100
    volumes:
      - ipcam-data:/app/data          # 摄像头配置、录像
      - ipcam-ssl:/etc/nginx/ssl      # SSL 证书
    healthcheck:
      test: ["CMD", "curl", "-fk", "https://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  ipcam-data:
    name: ipcam-web-data
  ipcam-ssl:
    name: ipcam-web-ssl
